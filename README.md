# Brewery-Order-Service

Created by Joel Attard, Shahyar Fida, Mike Kraemer, Julia Lebedzeva

This project is a Node.js-based microservice for user management in an e-commerce application, developed as part of a group project for Open Source Web Programming at Conestoga College. It handles creating orders from carts, fetching order details, updating statuses, canceling orders, and listing user orders, tying into the Brewery Database Service via RESTful APIs. We used TypeScript, Express, and Jest to keep it solid, secure, and testable—rocking over 89% branch coverage and aiming for 90%+. The service pulls environment variables with `dotenv-safe` from `.env.local` by default or whatever `NODE_ENV` points to. Key settings are the server port (default: 3002), an optional JWT secret for auth, and the Brewery API URL (default: http://localhost:5089). The `OrderController` class runs the show, using Axios for API calls and express-validator to check inputs.

To get started, clone the repo from `C:\git\Brewery-Order-Service` (or your fork), then run `npm install` to grab dependencies like `express`, `axios`, `jsonwebtoken`, `dotenv-safe`, and `express-validator`. For dev work, add `typescript`, `jest`, `@types/*` packages, and `ts-node` with `npm install --save-dev`. Set up a `.env.local` file with `PORT`, `JWT_SECRET` (optional), `BREWERY_API_URL`, and `NODE_ENV`, using `.env.example` as a guide. Start the service with `npm start` (assuming `ts-node src/index.ts`), or compile with `npm run build` and run `node dist/index.js`. Test it out with `npm run test` to hit Jest with coverage—aiming for 100%.

The project’s laid out with `src/config/config.ts` for environment stuff, `src/controllers/orderController.ts` for the core logic, `src/middleware/auth.ts` for JWT checks, and `src/index.ts` to kick things off. Tests live in `src/config/__tests__/config.test.ts` and `src/controllers/__tests__/orderController.test.ts`, mocking out Axios and express-validator.
Below are the endpoints, all under `/order` and expecting JSON unless noted. Protected routes need a Bearer token in the `Authorization` header.

1. `POST /create` - Creates an order from a user’s cart. Example input: `{"user_id": 1}` with header `Authorization: Bearer <token>`. Success response (201): `{"message": "Order created successfully", "order": {"id": "order1", "UserId": 1, "Items": [{"ProductId": 101, "Quantity": 2, "ProductName": "Beer", "PriceAtOrder": 5.99}]}}`. Error (400): `{"errors": [{"msg": "User ID must be a positive integer"}]}`.
2. `GET /:id` - Fetches an order by ID (authenticated). Example request: `GET /order/order1` with header `Authorization: Bearer <token>`. Success response (200): `{"id": "order1", "UserId": 1, "Status": "Pending"}`. Error (403): `{"message": "Unauthorized"}`.
3. `PUT /:id/status` - Updates an order’s status (authenticated). Example input: `{"status": "Shipped"}` with header `Authorization: Bearer <token>`. Success response (200): `{"message": "Order status updated successfully", "order": {"id": "order1", "Status": "Shipped"}}`. Error (400): `{"errors": [{"msg": "Invalid status"}]}`.
4. `DELETE /orders/:id` - Cancels an order (authenticated). Example request: `DELETE /order/orders/order1` with header `Authorization: Bearer <token>`. Success response (200): `{"message": "Order cancelled"}`. Error (404): `{"message": "Order not found"}`.
5. `GET /user/:user_id` - Lists a user’s orders (authenticated). Example request: `GET /order/user/1` with header `Authorization: Bearer <token>`. Success response (200): `[{"id": "order1", "UserId": 1, "Status": "Shipped"}]`. Error (403): `{"message": "Unauthorized"}`.
